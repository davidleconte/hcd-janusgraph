# =============================================================================
# direnv Configuration for Auto-Environment Activation
# =============================================================================
# Purpose: Automatically activate conda environment when entering project directory
# Usage:   Install direnv, then run 'direnv allow' in project root
# Docs:    https://direnv.net/
#
# Co-Authored-By: AdaL <adal@sylph.ai>
# =============================================================================

# Load parent .envrc if exists
source_up_if_exists

# Activate conda environment
if command -v conda &> /dev/null; then
    # Use layout anaconda for direnv's conda support
    layout anaconda janusgraph-analysis

    # Verify activation
    if [[ "$CONDA_DEFAULT_ENV" == "janusgraph-analysis" ]]; then
        log_status "Conda environment: janusgraph-analysis (Python 3.11)"
    else
        log_error "Failed to activate conda environment"
    fi
else
    log_error "Conda not found. Please install miniforge."
fi

# Load .env file if exists (for local overrides)
dotenv_if_exists

# Set project-specific environment variables
export PROJECT_NAME="janusgraph-demo"
export COMPOSE_PROJECT_NAME="${COMPOSE_PROJECT_NAME:-janusgraph-demo}"
# PODMAN_CONNECTION intentionally has no repository default.
# Set it in .env or your shell for the active machine connection.

# Validate Python version
if command -v python &> /dev/null; then
    PYTHON_VER=$(python -c "import sys; print(f'{sys.version_info.major}.{sys.version_info.minor}')")
    if [[ "$PYTHON_VER" != "3.11" ]]; then
        log_error "Wrong Python version: $PYTHON_VER (expected: 3.11)"
    fi
fi
