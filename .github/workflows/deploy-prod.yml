name: Deploy to Production (Gate Only)

on:
  workflow_dispatch:
    inputs:
      version:
        description: "Version to validate (e.g., v1.2.3)"
        required: true
        type: string
      confirm:
        description: 'Type "CONFIRM" to pass the production gate'
        required: true
        type: string

jobs:
  validate:
    name: Validate Deployment Request
    runs-on: ubuntu-latest
    steps:
      - name: Validate confirmation
        if: inputs.confirm != 'CONFIRM'
        run: |
          echo "CONFIRM token required"
          exit 1

      - name: Validate version format
        run: |
          if [[ ! "${{ inputs.version }}" =~ ^v[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
            echo "Invalid version format: ${{ inputs.version }}"
            exit 1
          fi

  production-gate:
    name: Production Gate (No Deployment)
    runs-on: ubuntu-latest
    needs: [validate]
    environment: production
    steps:
      - uses: actions/checkout@v6

      - name: Report status
        run: |
          echo "Production gate passed for ${{ inputs.version }}."
          echo "No deployment action is executed by this workflow."
          echo "Use approved production runbook and change-management process."
