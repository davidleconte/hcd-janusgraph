apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: run-tests
spec:
  params:
    - name: test-args
      type: string
      default: "-v --cov=src --cov=banking --cov-report=term-missing --cov-fail-under=70"
  workspaces:
    - name: source
  steps:
    - name: test
      image: python:3.11-slim
      workingDir: $(workspaces.source.path)/source
      script: |
        pip install uv
        uv pip install --system -r requirements.txt
        uv pip install --system pytest pytest-cov pytest-mock pytest-asyncio
        pytest $(params.test-args)
